# MAA 自动化任务调度器 - TODO

> 内部开发备忘，记录开发计划和进度。

## 🎯 下一步核心开发任务

### 1. **调度器逻辑重构**
- [x] **触发器实现调整**:
  - [x] **定时执行 (`scheduled`)**: 确保任务只在设定的时间段内（如 09:00-18:00）被触发。
  - [x] **间隔执行 (`interval`)**: 触发逻辑改为从【上一次任务执行完毕】后开始计算间隔。
  - [x] **随机时间执行 (`random_time`)**: 在设定的时间段内（如 10:00-12:00）随机选择一个时间点执行。
- [x] **任务队列与优先级**:
  - [x] 实现基于优先级的任务排队。
  - [x] 处理任务冲突（如资源组占用），实现任务的暂停和重新排队。

### 2. **执行器功能增强**
- [x] **前置任务**:
  - [x] **模拟器任务**: 集成 ADB 命令，实现自动唤醒屏幕。
  - [ ] (暂缓) 分辨率设置和应用启动。
- [x] **后置任务**:
  - [x] **日志关键词抓取**: 实现对临时任务日志的关键词扫描。
  - [x] **自定义通知**: 根据关键词匹配结果，发送包含自定义标题、Tag和内容的通知。

### 3. **Web 界面功能**
- [ ] **实现设置保存**:
  - [ ] 后端提供 `/api/config/save` 接口。
  - [ ] 前端设置页面添加“保存”按钮的实际功能，将修改后的配置持久化到 `config.yaml`。
- [ ] **任务编辑器完善**:
  - [ ] 调整前端表单以匹配新的触发器配置（如时间段选择）。

### 4. **配置系统完善**
- [x] **模型更新**:
  - [x] 更新 `config.py` 中的 Pydantic 模型以匹配新的任务流程。
- [x] **通知开关**:
  - [x] 在 `config.yaml` 中增加 `notify_on_startup` 和 `notify_on_shutdown` 开关。
  - [x] 在主程序中根据配置决定是否发送启动/关闭通知。

### 5. **测试**
- [x] 编写或更新测试脚本，对重构后的功能进行完整测试。

---

## ✅ 已完成/待清理的功能

- [x] **系统基础架构**: CLI、Web服务、基本调度循环。
- [x] **基础Web界面**: 仪表板、任务列表、监控、日志、设置页面框架。
- [x] **基础通知**: 系统启动/关闭、任务成功/失败的 Webhook 推送。
- [x] **资源分组概念**: 已有基本模型，待实现调度逻辑。
- [x] **日志系统**: 已支持全局和临时日志记录。
- [x] **修复 `AttributeError`**: 解决了由于代码重复和不正确的配置调用导致的一系列启动错误。
- [x] **修复通知服务错误**: 解决了由于占位符 URL 导致的 `ClientConnectorDNSError`。
- [x] **修复资源组警告**: 将任务配置文件中的 `general` 资源组更正为 `default`。